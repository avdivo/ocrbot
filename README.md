# Телеграмм бот для распознавания текста на изображениях

**Ссылка на бота: [ocr_bot](https://t.me/ocr_bot)**
## Функции
- Выбор языка распознавания с помощью клавиатуры
- Распознавание текста на отправленном в бот изображении
- Сохранение истории текстов с возможностью ее просмотра

## Описание
- Бот работает на основе фреймворка FastAPI и библиотеки aiogram.  
- Построен на основе асинхронной архитектуры.
- Использует Webhook для взаимодействия с Telegram API.  
- Использует PaddleOCR для распознавания текста на изображениях.  
- Сохраняет историю распознанных текстов для каждого пользователя отдельно. Хранит в файлах в папке 
`data/recognized_texts`

## Используемые технологии
- Python 3.11
- FastAPI (для веб-сервера)
- aiogram (для работы с Telegram API)
- PaddleOCR (для распознавания текста)
- uvicorn (для запуска FastAPI)

## Структура проекта
```
ocrbot/
│
├── bot/                      # Папка для логики бота
│   ├── __init__.py           # Инициализация пакета
│   ├── handlers.py           # Обработчики команд и сообщений
│   └── states.py             # Определение состояний
│
├── data/                     # Папка для хранения данных
│   └── recognized_texts/     # Папка для хранения распознанных текстов
│
├── services/                 # Папка для внешних сервисов
│   ├── __init__.py           # Инициализация пакета
│   └── ocr_service.py        # Логика работы с Paddle OCR
│
├── requirements.txt          # Зависимости проекта
├── main.py                   # Основной файл запуска приложения
├── README.md                 # Документация проекта
├── config.py                 # Конфигурация приложения
│
├── Dockerfile                 # Файл конфигурации Docker
├── docker-compose.yml         # Файл для управления многоконтейнерными приложениями
└── .env                       # Файл для переменных окружения (например, токены и настройки)
```

## Установка и запуск
1. Клонировать репозиторий
2. Создать виртуальное окружение и активировать его
3. Установить зависимости из requirements.txt
4. Создать файл .env и добавить в него переменные окружения:
    - BOT_TOKEN=<токен вашего бота>
    - WEBHOOK_HOST=https://4a9b-37-19-205-220.ngrok-free.app
    - WEBHOOK_PATH=/webhook
    - WEBAPP_HOST=0.0.0.0  
    - WEBAPP_PORT=8000
 
    С такими настройками бот автоматически установит вебхук на адрес https://4a9b-37-19-205-220.ngrok-free.app/webhook
    (можно заметить что это адрес ngrok, который можно использовать для приема запросов из внешнего интернета на 
    локальный компьютер).  

    Настройки ngrok:  
    https://4a9b-37-19-205-220.ngrok-free.app -> http://localhost:8000  
    FastApi будет принимать запросы на url 0.0.0.0, порт 8000.
5. Запустить бота командой
    ```bash
    uvicorn main:app --reload
    ```
6. После остановки сервера вебхук автоматически удалится из настроек Телеграмм

## Запуск в контейнере

1. Клонировать репозиторий
2. зайти в папку проекта
```commandline
cd telegram-bot
```
3. Добавить .env файл с переменными окружения
4. Запустить контейнер
```bash
docker-compose up
```